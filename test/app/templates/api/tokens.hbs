<div class="columns small-12">
  <div class="Box">
    <div class="api-section row">
      <div class="columns small-12 u-mb-3">
        <div class="headline-group u-clearfix">
          {{#unless isReadOnly}}
            {{#link-to 'api.tokens.new' class="Button Button--small u-floatRight"}}Generate New Token{{/link-to}}
          {{/unless}}
          <h2>Personal access tokens</h2>
          <p>Tokens you have generated to access the <a href="https://developers.digitalocean.com/documentation/v2/">DigitalOcean API.</a></p>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="columns small-12">
        {{#if emptyState}}
          <div class="EmptyState--simple u-clearfix">
            <p>You have no tokens authorized to access your account.</p>
          </div>
        {{else}}
          <table class="u-mb-3 stack-section api-table">
            <thead>
              <tr>
                {{table-header action="sort" isLoading=sorting sortCol=sort sortDir=sort_direction col="name" text="Name"}}
                {{table-header col="scope" text="Scope" noSorting=true}}
                {{table-header action="sort" isLoading=sorting sortCol=sort sortDir=sort_direction  col="created_at" text="Created"}}
                {{#unless isReadOnly}}
                  {{table-header col="action" noSorting=true}}
                {{/unless}}
              </tr>
            </thead>
            <tbody>
              {{#each filteredModel as |token|}}
                <tr>
                  <td class="name">
                    {{#ellipsis-text text=token.name}}
                      {{#link-to 'api.tokens.show' token}}
                        {{token.name}}
                      {{/link-to}}
                    {{/ellipsis-text}}
                  </td>
                  <td class="scopes">
                    {{#each token.scopes as |scope|}}
                      <p class="Badge Badge--uppercase Badge--grey u-floatLeft u-mr-2 u-mb-0">{{scope}}</p>
                    {{/each}}
                  </td>
                  <td class="created">
                    {{date-to-human-time date=token.createdAt}}
                  </td>
                  {{#unless isReadOnly}}
                    <td class="action stackRight">
                      <div class="actions">
                        {{#if token.isDeleted}}
                          <div class="u-floatRight">
                            {{loading-spinner message="Deleting"}}
                          </div>
                        {{else if token.isUpdatingToken}}
                          <div class="u-floatRight">
                            {{loading-spinner message="Regenerating"}}
                          </div>
                        {{else if token.isSaving}}
                          {{loading-spinner message="Saving"}}
                        {{else}}
                          {{dropdown-menu closeOnClick=true title="More" items=menuItems action="menuItemClick" actionParams=token}}
                        {{/if}}
                      </div>
                    </td>
                  {{/unless}}
                </tr>
                {{#if token.token}}
                  <tr class="copy-token is-sensitive">
                    <td colspan="4">
                      <span class="u-nw">
                        {{click-to-copy text=token.token}}
                      </span>
                    </td>
                  </tr>
                {{/if}}
              {{/each}}
            </tbody>
          </table>
        {{/if}}
        <div class="info-bubble u-mt-3">
          <p class="small">Personal access tokens function like a combined name and password for API authentication.</p>
        </div>
        {{#if needsPagination}}
          {{paginator-full
            linkToPage="api.tokens"
            isLoading=paginating
            pages=model.meta.pagination.pages
            currentPage=model.meta.pagination.current_page
            action="changePage"
            scrollToAfterLoad="#aurora-container"
          }}
        {{/if}}
      </div>
    </div>
  </div>
</div>

{{#if deleteToken}}
  {{#modal-window title="Delete token" contentClasses="confirm-small" size="small" saveText="Delete Token" saveClasses="Button--red" onHide="onModalHide"}}
    <p class="u-grey">Are you sure you want to delete this token?</p>
  {{/modal-window}}
{{/if}}
